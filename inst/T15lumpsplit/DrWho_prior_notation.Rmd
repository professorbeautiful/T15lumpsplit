


### DETAILS: Bayes calculation of Dr. Who\'s prior and posterior probabilities" <!-- #title -->

Here is a prior that represents Dr. Who's view that each one has their own personal ***prior*** belief, represented by each distribution $\pi _{Split}^{}({\bf{p}})$ or $\pi _{Lump}^{}({\bf{p}})$. 
And, let's suppose for now that Dr. Who thinks that one or the other is absolutely correct. But "who knows which one?":
  
  
$$
\def\Who{\mathbf{Who}}
\begin{aligned}
\pi _{\Who}^{}({\bf{p}}) = & ~~~~~\pi _{\Who}^{}(\phi  = Split)~~~\pi _{Split}^{}({\bf{p}}) \\
& + \pi _{\Who}^{}(\phi  = Lump)~~\pi _{Lump}^{}({\bf{p}}).
\end{aligned}
$$
where $\pi$ is not the number "pi"  but is just a traditional symbol for a Bayesian probability representing current belief.  

NOTE: This marginalizes out (averages over)  
the *nuisance parameter* $\phi$  (who is right?)  
over the joint distribution of ( ${p_{R.D}}~|~\phi$)!  
  
  
  Briefly Bayes Theorem without a nuisance parameter is  
(eliminating the usual $\Pr$ & using square brackets, for brevity):
  
$$
\begin{array}{l}
    \quad [\theta |X] = \frac{{[X,\theta ]}}{X} = \frac{{[X,\theta ]}}{{\int\limits_\theta  {} [X,\theta ]}} = \frac{{[X|\theta ][\theta ]}}{{\int\limits_\theta  {} [X,\theta ]}}\\
    \end{array}.
$$

And Bayes Theorem with a nuisance parameter is:
  
$$
\begin{array}{l}
    \quad [\theta |X] = \sum\limits_\phi  {} [\theta ,\phi |X] = \frac{{\sum\limits_\phi  {} [X,\theta ,\phi ]}}{{\sum\limits_{\phi ,\theta } {} [X,\theta ,\phi ]}}
    \end{array}.
$$
 


IN SUMMARY:

To apply the Bayes theorem principles:  
* We know the data, so we condition on $\bf{n}$.  (Divide by its probability.)  
* We dont' know (and don't care about) $\phi$  
  ($\phi$, whether Dr.Lump or Dr.Split is correct, is the "nuisance parameter"), so we "marginalize" over it.  (Average over $\phi$.)
* All that's left is $\bf{p}$, what we care about.  

Now, the details:

### Dr. Who’s posterior distribution for ${\bf{p}}$

We might care only about ${\bf{p}}=Pr(\mathrm{response~given~D})={p_{R.D}}$.  Then Bayes says, average over what you don't care about.

Now we put a little asterisk $\pi^*$ over the $\pi$ to mean "posterior" (after seeing the data) instead of "prior" (before seeing the data).  That's nice, we don't have to keep writing "given the data" over and over.

Averaging over $\phi$,  
(that's the big green 'plus', 
$\large\bf\color{green}{+}$)  
Dr. Who’s posterior distribution for ${\bf{p}}$ is:
$$
\begin{aligned}
\pi _{\Who}^*({p_{R.D}}) = &~~~~~~\pi _{\Who}^*(\phi  = Split) ~~\times \pi _{Split}^*({p_{R.D}})  \\
 &~{\bf\color{green}{\large+}} ~ \pi _{\Who}^*(\phi  = Lump)\times \pi _{Lump}^*({p_{R.D}}),
\end{aligned}
$$
(The little asterisks just save us the trouble of writing over and over "given data" "given data" "given data".)  

That means knowing  
* the MARGINAL POSTERIOR probabilities  
$~~~~~~~$ for Lump $\pi _{\Who}^*(\phi  = Lump)$ 
$~~~~~~~$ and for Split  $\pi _{\Who}^*(\phi  = Split)$  
* the CONDITIONAL POSTERIOR probability distributions  
$~~~~~~~$ for ${\bf{p}}$ is  
$~~~~~~~~~~~~\pi_{Lump}^*({p_{R.D}})~~~~$ if Lump is correct,  and  
 $~~~~~~~~~~~~\pi _{Split}^*({p_{R.D}}~~~~$)  if Split is correct.  

So... how do we get THEM?


####  Dr Who's posterior probability that $Split$ is correct

Here are those MARGINAL POSTERIOR probabilities!  

$$\pi _{\Who}^*(\phi  = Split) = \frac{{\pi (Split){m_{Split}}}}{{\pi (Split){m_{Split}} + \pi (Lump){m_{Lump}}}},
$$
and the $m$ values are the two respective marginal probabilities of the observed data table $({n_{RD}},{n_{RL}},{n_{ND}},{n_{NL}})$ . 

```{r}
TextQuestion("If Dr. Who gives Dr. Lump and Dr. Split equal weight BEFORE seeing the data, is this still true AFTER seeing the data?
")
```

#### Each marginal probability of the data table, given $\phi$ (which Doctor is right.) <!-- #title -->

Here are those CONDITIONAL POSTERIOR probability distributions!

```{r, echo=FALSE}
output$mSplit = renderText({
  analysisName = 'whoMixturePlot'
  source(analysisReactiveSetup_DTC, local=TRUE)
  signif(digits=3, mSplit(thisData)); 
  })
```

If *Split* is correct, then the (marginal) probability of getting the data we observed is  

$~~~~~~~$ $m_{Split}$ = **`r   textOutput('mSplit', inline=TRUE)`**.


***Calculating $m_{Split}$:***  `r actionButton(class='sidebar', inputId='DrSplitEquation.Rmd', label =  'Dr Split\'s Equation' )`  <!-- #title -->
```{r}
#### this works!
observe( {
  if(!is.null(input$DrSplitEquation.Rmd) ) {
    if(input$DrSplitEquation.Rmd > 0) {
        showModal(modalDialog(size='xl', title="Dr Split\'s Equation", easyClose = T,
                               footer=modalButton('OK'),
                              inclRmd('DrSplitEquation.Rmd')))
    }
  }
}
)
```

```{r}
output$mLump = renderText({
  analysisName = 'whoMixturePlot'
  source(analysisReactiveSetup_DTC, local=TRUE)
  signif(digits=3, mLump(thisData)); 
})
```

If *Lump* is correct,  
then the (marginal) probability of getting the data we observed is:  
  $~~~~~~~$ $m_{Lump}$ = **`r   textOutput('mLump', inline=TRUE)`**.

***Calculating $m_{Lump}$:***   `r actionButton(class='sidebar', inputId='DrLumpEquation.Rmd', label =  'Dr Lump\'s Equation' )`  <!-- #title -->

```{r showModal "Dr Lump\'s Equation"}

#### this works!
observe( {
  if(!is.null(input$DrLumpEquation.Rmd) ) {
    if(input$DrLumpEquation.Rmd > 0) {
        showModal(modalDialog(size='xl', title="Dr Lump\'s Equation", easyClose = T,
                               footer=modalButton('OK'),
                              inclRmd('DrLumpEquation.Rmd')))
    }
  }
}
)
```
```{r BFequation}
output$BFequation = renderText({
  #strong(
    paste(#'xXXXX', #paste0(collapse='', rep('&nbsp;', 10)), 
          signif(digits=3, mSplit(thisData)), '/',  signif(digits=3,mLump(thisData)), ' = ', signif(digits=3,DrWhoBayesFactor(thisData)))
  #)
})
```

The ***Bayes Factor*** in favor of ***Dr. Split*** is  
$~~~~~~~$ 
$m_{Split}$/$m_{Lump}$  = **`r  textOutput('BFequation', inline=TRUE)`**  

```{r postprob}
output$postprobexpression = renderUI(
  HTML(paste0(
    signif(digits=3,DrWhoBayesFactor(thisData)), ' / (1 + ', 
    signif(digits=3,DrWhoBayesFactor(thisData)), ') = ',
    strong(signif(digits=3, oddsToProb(as.numeric(DrWhoBayesFactor(thisData)))))
  ))
)
```
So the posterior probability  $Pr(Split | data)$ = `r uiOutput('postprobexpression', inline=TRUE)`.

***Fun facts about the Bayes Factors:***   `r actionButton(class='sidebar', inputId='BayesFactor.Rmd', label =  'Bayes Factors' )`  <!-- #title -->
```{r}
observe( {
  if(!is.null(input$BayesFactor.Rmd) ) {
    if(input$BayesFactor.Rmd > 0) {
        showModal(modalDialog(size='xl', title="Bayes Factors", easyClose = T,
                               footer=modalButton('OK'),
                              inclRmd('BayesFactor.Rmd')))
    }
  }
}
)

```

Here is the R code to calculating the marginals and the Bayes factor  
if you are interested:
  
```{r DrWhoBayesFactor-functions.R}
DrWhoBayesFactor.code = readLines(con='DrWhoBayesFactor-functions.R')
DrWhoBayesFactor.code = 
  HTML(gsub('  ', '&nbsp;&nbsp;',
            paste(DrWhoBayesFactor.code,
                  collapse='<br>\n')))
conditionalPanelWithCheckbox(
  labelString = 'Code for the Lump and Split marginal probabilities',
  html=DrWhoBayesFactor.code,
  initialValue=FALSE
)
```
